version: "3.9"

services:
  # üß† Backend Flask
  transcriber:
    container_name: video-transcriber
    build:
      context: ./be
      dockerfile: Dockerfile
    image: video-transcriber:latest
    restart: unless-stopped
    ports:
      - "8000:8000" # Flask port
    environment:
      - TZ=Asia/Ho_Chi_Minh
      - PYTHONUNBUFFERED=1
    volumes:
      - ./be/downloads:/app/downloads # mount ƒë·ªÉ l∆∞u file ra ngo√†i
      - ./be/models:/app/models # mount cache model (Whisper)
    networks:
      - app-network

  # üíª Frontend React
  frontend:
    container_name: video-transcriber-fe
    build:
      context: ./fe
      dockerfile: Dockerfile
    image: video-transcriber-fe:latest
    restart: unless-stopped
    ports:
      - "3000:4173" # React dev / serve port
    depends_on:
      - transcriber
    environment:
      - CHOKIDAR_USEPOLLING=true
      - WDS_SOCKET_PORT=0
      # üëâ C·∫•u h√¨nh API URL tr·ªè v·ªÅ backend container
      - VITE_BASE_URL=http://transcriber:8000
      - VITE_APP_NAME='Extract Video'
    networks:
      - app-network

networks:
  app-network:
    driver: bridge
